@model OSCEUKDI.Presentation.Models.LoginVMAdmin
@{
    ViewBag.Title = "Login";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutLogin.cshtml";
}

<section id="hero" class="main">
    <div class="hero-container">
        <h3> Sistem Supply Management </h3>
        <h1>P T . X Y Z</h1>
      
        <p>
            <a href="#" class="btn-get-started scrollto login-btn">Login</a>
            <a href="#" class="btn-get-started scrollto signup-btn">Daftar</a>
        </p>
    </div>
</section>


<div class="side-login">
    <!-- cancel btn -->
    <a href="#" class="login-cancel-btn">
        <i class="fas fa-arrow-left"></i>
    </a>
    <!-- headeing -->
    <strong><span class="m-1">Login</span></strong>
    <!-- form -->
    @using (Html.BeginForm(new { ReturnUrl = ViewBag.ReturnUrl }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <form action="" method="POST">
            <label for="">Email <samp> *</samp></label>
            <div class="email">
                <i class="far fa-paper-plane"></i>
                @Html.EditorFor(model => model.Username, new { htmlAttributes = new { @class = "form-control input-md", maxlength = "150", placeholder = "Email" } })
                @Html.ValidationMessageFor(model => model.Username, "", new { @class = "text-danger" })
            </div>
            <!-- password -->
            <label for="">Password <samp> *</samp></label>
            <div class="password">
                <i class="fas fa-lock"></i>
                @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @class = "form-control input-md", maxlength = "150", placeholder = "Password", type = "password" } })
                @Html.ValidationMessageFor(model => model.Password, "", new { @class = "text-danger" })
            </div>
            <!-- login btn -->
            <input type="submit" name="login" value="Login" style="cursor:pointer" class="login">
        </form>
    }
    <!-- relative bottom text -->
    <div class="relative-text">
        <p>
            &copy;
            <script>
                document.write(new Date().getFullYear())
            </script>
            - All Right Reserved - Login.
        </p>
    </div>
</div>



<!-- section sign up side bar -->
<div class="side-sign-up">
    <!-- cancel btn -->
    <a href="#" class="sign-up-cancel-btn">
        <i class="fas fa-arrow-left"></i>
    </a>
    <!-- headeing -->
    <strong><span class="m-1">Daftar</span></strong>
    <!-- form -->
    @*<form action="<?= base_url('auth/daftar'); ?>" method="POST">*@
    <form>
        <!-- Fullname -->
        <label for="">Nama Perusahaan<samp>*</samp></label>
        <div class="fullname">
            <i class="far fa-user"></i>
            <input type="text" name="NamaPerusahaan" id="NamaPerusahaan" placeholder="Masukan Nama Perusahaan..." required>
        </div>
        <!-- email -->
        <label for="">Email<samp>*</samp></label>
        <div class="email">
            <i class="far fa-paper-plane"></i>
            <input type="email" name="Email" id="Email" placeholder="Masukan Email..." required>
        </div>
        <!-- password -->
        <label for="">Password<samp>*</samp></label>
        <div class="password">
            <i class="fas fa-lock"></i>
            <input type="password" name="Password1" id="Password1" placeholder="Masukan Password..." required>
        </div>
        <label for="">Telepon<samp>*</samp></label>
        <div class="fullname">
            <i class="fas fa-phone"></i>
            <input type="text" name="Phone" id="Phone" placeholder="Phone..." required>
        </div>
        <label for="">Photo<samp>*</samp></label>
        <div class="fullname">

            <input class="form-control"
                   type="file"
                   id="Photo"
                   accept="image/*"
                   onchange="ImageToBase64(this)"
                   style="margin-top: 10px; border: 1px solid #ced4da; border-radius: 0.25rem; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; color: #495057; background-color: #fff; background-clip: padding-box; transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;">
            <input type="hidden" id="Photo-strImgBs64" />
        </div>
        <!-- login btn -->
        <div>
        </div>
    </form>
    <button type="submit" class=" signup btn btn-default" style="margin:20px;width:90% !important">Daftar</button>
    <div class="relative-text">
        <p>
            &copy;
            <script>
                document.write(new Date().getFullYear())
            </script>
            - All Right Reserved - Login.
        </p>
    </div>

</div>
@section scripts{
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        var obj = new Object();
        function ImageToBase64(inputGambar) {
            var file = inputGambar.files[0];
            var batasUkuranFile = 5 * 1024 * 1024; // 5 MB

            if (file) {
                if (file.type.startsWith('image/')) {
                    if (file.size <= batasUkuranFile) {
                        var pembaca = new FileReader();
                        pembaca.onloadend = function () {
                            var stringBase64 = pembaca.result.split(',')[1];
                            // Mengasumsikan Anda memiliki elemen dengan ID "Photo-strImgBs64"
                            $('#Photo-strImgBs64').val(stringBase64);
                        };
                        pembaca.readAsDataURL(file);
                    } else {
                        tanganiErrorFile('Ukuran file terlalu besar. Maksimum 5 MB diizinkan.');
                    }
                } else {
                    tanganiErrorFile('Pilih file gambar yang valid.');
                }
            }
        }

        function tanganiErrorFile(pesanError) {
            Swal.fire({
                icon: 'warning',
                text: pesanError,
                showConfirmButton: false,
                timer: 1500
            });
            // Mengatur ulang nilai input file
            $('#Photo').val('');
        }

        $('.signup').click(function (e) {
            obj = {};
            obj.UserName = $('#NamaPerusahaan').val();
            obj.Email = $('#Email').val();
            obj.Password = $('#Password1').val();
            obj.Phone = $('#Phone').val();
            obj.Photo = $('#Photo-strImgBs64').val();
            obj.RoleId = 19;
            var isEmpty = Object.values(obj).some(value => !value);
            if (isEmpty ) {
                Swal.fire({
                    icon: 'warning',
                    text: 'Harap mengisi semua field input.',
                    showConfirmButton: false,
                    timer: 1500
                })
            } else {
                $.ajax({
                    url: "/UserManage/AddUser",
                    'type': 'POST',
                    'data': { user: obj },
                    'dataType': 'json',
                }).done((result) => {
                    if (result.status == 200) {
                        Swal.fire({
                            title: "Good job!",
                            text: "Berhasil Registrasi, silahkan Login menggunakan menggunakan akun anda.",
                            icon: "success",
                            showConfirmButton: false,
                            timer: 2000
                        }).then(function () {
                            window.location.reload();
                        });
                    } else if (result.status == 400) {
                        Swal.fire({
                            title: "Failed!",
                            text: "Data Gagal ditambahkan,Email Sudah terdaftar.",
                            icon: "error",
                            showConfirmButton: false,
                            timer: 2000
                        })
                    }
                }).fail((error) => {
                    Swal.fire({
                        title: "Failed!",
                        text: "Data Gagal ditambahkan.",
                        icon: "error",
                        showConfirmButton: false,
                        timer: 1500
                    })
                })

            }
        });
    </script>

}
